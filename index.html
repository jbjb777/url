<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>URL ë‹¨ì¶•ê¸° - ì •ë¹ˆ777</title>
  <script type="module">
    // Firebase SDK ë¶ˆëŸ¬ì˜¤ê¸°
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

 
    const firebaseConfig = {
      apiKey: "AIzaSyB8OHhR0Vjan_nNdCczb5e2bOuDBYYRiIg",
      authDomain: "urlshare-718c1.firebaseapp.com",
      databaseURL: "https://urlshare-718c1-default-rtdb.firebaseio.com",
      projectId: "urlshare-718c1",
      storageBucket: "urlshare-718c1.firebasestorage.app",
      messagingSenderId: "666729308999",
      appId: "1:666729308999:web:a7f6d363e88b1d5ed5a262",
      measurementId: "G-VZH9BNQ3VR"
    };

    // Firebase ì´ˆê¸°í™”
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // í˜„ì¬ ê²½ë¡œ ê°ì§€
    const path = window.location.pathname.slice(1); // '/' ì œê±°

    if (path) {
      // ìŠ¬ë˜ì‹œ ë’¤ì— ë­”ê°€ ìˆë‹¤ë©´ (ì¦‰, ë‹¨ì¶• ì£¼ì†Œë¡œ ì ‘ì†í•œ ê²½ìš°)
      const dbRef = ref(db);
      get(child(dbRef, `urls/${encodeURIComponent(path)}`)).then((snapshot) => {
        if (snapshot.exists()) {
          const original = snapshot.val().original;
          window.location.href = original; // ì›ë˜ ì£¼ì†Œë¡œ ë¦¬ë””ë ‰íŠ¸
        } else {
          document.body.innerHTML = `<h2>âŒ ë‹¨ì¶• ë§í¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</h2>`;
        }
      }).catch((error) => {
        console.error(error);
        document.body.innerHTML = `<h2>âš ï¸ ì˜¤ë¥˜ ë°œìƒ: ${error.message}</h2>`;
      });
    } else {
      // ë©”ì¸ í˜ì´ì§€ UI í‘œì‹œ
      document.addEventListener("DOMContentLoaded", () => {
        document.body.innerHTML = `
          <div style="max-width:600px;margin:50px auto;text-align:center;font-family:sans-serif;">
            <h1>ğŸ”— URL ë‹¨ì¶•ê¸°</h1>
            <input id="urlInput" type="text" placeholder="ë‹¨ì¶•í•  URL ì…ë ¥" 
              style="width:80%;padding:10px;border-radius:8px;border:1px solid #ccc;">
            <button id="shortenBtn" 
              style="padding:10px 20px;margin-left:10px;border:none;background:#0078ff;color:white;border-radius:8px;cursor:pointer;">ë‹¨ì¶•í•˜ê¸°</button>
            <p id="result" style="margin-top:20px;font-size:1.1em;"></p>
          </div>
        `;

        const input = document.getElementById("urlInput");
        const btn = document.getElementById("shortenBtn");
        const result = document.getElementById("result");

        btn.addEventListener("click", async () => {
          const longUrl = input.value.trim();
          if (!longUrl) {
            alert("URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            return;
          }

          // ê²½ë¡œì— ì‚¬ìš©í•  í‚¤ (ê¸´ URLë„ ê·¸ëŒ€ë¡œ ì“¸ ìˆ˜ ìˆë„ë¡ ì¸ì½”ë”©)
          const key = encodeURIComponent(longUrl);

          // Firebaseì— ì €ì¥
          await set(ref(db, `urls/${key}`), { original: longUrl });

          const shortUrl = `https://url.jbjb.r-e.kr/${longUrl}`;
          result.innerHTML = `âœ… ë‹¨ì¶• URL: <a href="${shortUrl}" target="_blank">${shortUrl}</a>`;
        });
      });
    }
  </script>
</head>
<body>
</body>
</html>
