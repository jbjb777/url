<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>URL ë‹¨ì¶•ê¸° - ì •ë¹ˆ777</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB8OHhR0Vjan_nNdCczb5e2bOuDBYYRiIg",
      authDomain: "urlshare-718c1.firebaseapp.com",
      databaseURL: "https://urlshare-718c1-default-rtdb.firebaseio.com",
      projectId: "urlshare-718c1",
      storageBucket: "urlshare-718c1.firebasestorage.app",
      messagingSenderId: "666729308999",
      appId: "1:666729308999:web:a7f6d363e88b1d5ed5a262",
      measurementId: "G-VZH9BNQ3VR"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const path = window.location.pathname.slice(1); // '/' ì œê±°

    // âœ… ëœë¤ ë¬¸ìì—´ ìƒì„± í•¨ìˆ˜
    function generateCode(length = 6) {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      let result = '';
      for (let i = 0; i < length; i++) result += chars.charAt(Math.floor(Math.random() * chars.length));
      return result;
    }

    if (path) {
      // ğŸ”— ë‹¨ì¶• URLë¡œ ì ‘ì†í–ˆì„ ë•Œ
      const dbRef = ref(db);
      get(child(dbRef, `urls/${path}`))
        .then(snapshot => {
          if (snapshot.exists()) {
            window.location.href = snapshot.val().original;
          } else {
            document.body.innerHTML = `<h2>âŒ ë‹¨ì¶• ë§í¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</h2>`;
          }
        })
        .catch(err => {
          document.body.innerHTML = `<h2>âš ï¸ ì˜¤ë¥˜ ë°œìƒ: ${err.message}</h2>`;
        });
    } else {
      // ğŸ  ë©”ì¸ í˜ì´ì§€
      document.addEventListener("DOMContentLoaded", () => {
        document.body.innerHTML = `
          <div style="max-width:600px;margin:60px auto;text-align:center;font-family:sans-serif;">
            <h1>ğŸ”— URL ë‹¨ì¶•ê¸°</h1>
            <input id="urlInput" type="text" placeholder="ë‹¨ì¶•í•  URL ì…ë ¥ (ì˜ˆ: https://naver.com)"
              style="width:80%;padding:10px;border-radius:8px;border:1px solid #ccc;">
            <button id="shortenBtn" 
              style="padding:10px 20px;margin-left:10px;border:none;background:#0078ff;color:white;border-radius:8px;cursor:pointer;">ë‹¨ì¶•í•˜ê¸°</button>
            <p id="result" style="margin-top:20px;font-size:1.1em;"></p>
          </div>
        `;

        const input = document.getElementById("urlInput");
        const btn = document.getElementById("shortenBtn");
        const result = document.getElementById("result");

        btn.addEventListener("click", async () => {
          const longUrl = input.value.trim();
          if (!longUrl.startsWith("http://") && !longUrl.startsWith("https://")) {
            alert("URLì€ ë°˜ë“œì‹œ http:// ë˜ëŠ” https:// ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤!");
            return;
          }

          const code = generateCode();
          await set(ref(db, `urls/${code}`), { original: longUrl });

          const shortUrl = `https://url.jbjb.r-e.kr/${code}`;
          result.innerHTML = `âœ… ë‹¨ì¶• URL: <a href="${shortUrl}" target="_blank">${shortUrl}</a>`;
        });
      });
    }
  </script>
</head>
<body></body>
</html>
